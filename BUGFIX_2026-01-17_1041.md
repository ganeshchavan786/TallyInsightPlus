# Bug Fix Task List
**Date:** 2026-01-17 10:41 AM
**Issue:** Login ‡§®‡§Ç‡§§‡§∞ Dashboard ‡§µ‡§∞ ‡§ó‡•á‡§≤‡•ã, ‡§™‡§£ Sync page ‡§µ‡§∞ ‡§ú‡§æ‡§Ø‡§≤‡§æ ‡§π‡§µ‡•á ‡§π‡•ã‡§§‡•á

---

## Problem Analysis

### Observed Issues:

1. **Main Issue:** Login ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞ Dashboard ‡§µ‡§∞ ‡§ó‡•á‡§≤‡•ã (company_count = 0 ‡§Ö‡§∏‡§§‡§æ‡§®‡§æ)
   - Expected: `tally-sync.html` ‡§µ‡§∞ redirect ‡§µ‡•ç‡§π‡§æ‡§Ø‡§≤‡§æ ‡§π‡§µ‡•á ‡§π‡•ã‡§§‡•á
   - Actual: `dashboard.html` ‡§µ‡§∞ ‡§ó‡•á‡§≤‡•ã

2. **CSP (Content Security Policy) Errors:**
   - `connect-src 'self'` policy violation
   - Google Fonts load ‡§π‡•ã‡§§ ‡§®‡§æ‡§π‡•Ä‡§§
   - External URLs blocked

3. **JavaScript Error:**
   - `Modal is not defined` at dashboard.html:333
   - Companies load failed

4. **Service Worker Issues:**
   - sw.js:52 - Fetch API errors
   - PWA icon missing

---

## Root Cause Analysis

| Issue | Root Cause |
|-------|------------|
| Dashboard redirect | `company_count` localStorage ‡§Æ‡§ß‡•ç‡§Ø‡•á save ‡§π‡•ã‡§§ ‡§®‡§æ‡§π‡•Ä ‡§ï‡§ø‡§Ç‡§µ‡§æ check ‡§π‡•ã‡§§ ‡§®‡§æ‡§π‡•Ä |
| CSP Errors | Service Worker ‡§Æ‡§ß‡•ç‡§Ø‡•á strict CSP policy |
| Modal not defined | Modal.js script missing ‡§ï‡§ø‡§Ç‡§µ‡§æ load order issue |
| Font errors | CSP blocking external fonts |

---

## Task List

### Priority 1: Fix Redirect Logic (CRITICAL)

| Task ID | Task Description | Status | File |
|---------|------------------|--------|------|
| BF-01 | Login response ‡§Æ‡§ß‡•ç‡§Ø‡•á company_count properly return ‡§π‡•ã‡§§‡•ã‡§Ø ‡§ï‡§æ verify | üî¥ | auth_controller.py |
| BF-02 | Login.html ‡§Æ‡§ß‡•ç‡§Ø‡•á company_count localStorage ‡§Æ‡§ß‡•ç‡§Ø‡•á save ‡§π‡•ã‡§§‡•ã‡§Ø ‡§ï‡§æ check | üî¥ | login.html |
| BF-03 | Dashboard.html ‡§Æ‡§ß‡•ç‡§Ø‡•á company_count check logic verify | üî¥ | dashboard.html |
| BF-04 | API response debug ‡§ï‡§∞‡•Ç‡§® actual company_count ‡§¨‡§ò‡§£‡•á | üî¥ | Browser Console |

### Priority 2: Fix CSP Errors

| Task ID | Task Description | Status | File |
|---------|------------------|--------|------|
| BF-05 | Service Worker CSP policy update ‡§ï‡§∞‡§£‡•á | üî¥ | sw.js |
| BF-06 | manifest.json ‡§Æ‡§ß‡•ç‡§Ø‡•á CSP headers add ‡§ï‡§∞‡§£‡•á | üî¥ | manifest.json |
| BF-07 | Google Fonts local ‡§Æ‡§ß‡•ç‡§Ø‡•á download ‡§ï‡§∞‡§£‡•á (optional) | üî¥ | css/ |

### Priority 3: Fix JavaScript Errors

| Task ID | Task Description | Status | File |
|---------|------------------|--------|------|
| BF-08 | Modal.js script include ‡§ï‡§∞‡§£‡•á dashboard.html ‡§Æ‡§ß‡•ç‡§Ø‡•á | üî¥ | dashboard.html |
| BF-09 | Script load order fix ‡§ï‡§∞‡§£‡•á | üî¥ | dashboard.html |

### Priority 4: Fix PWA Issues

| Task ID | Task Description | Status | File |
|---------|------------------|--------|------|
| BF-10 | PWA icon path fix ‡§ï‡§∞‡§£‡•á | üî¥ | manifest.json |

---

## Debugging Steps (Before Coding)

### Step 1: Check API Response
```
Browser Console ‡§Æ‡§ß‡•ç‡§Ø‡•á:
1. Login ‡§ï‡§∞‡§æ
2. Network tab ‡§¨‡§ò‡§æ
3. /api/v1/auth/login response ‡§Æ‡§ß‡•ç‡§Ø‡•á company_count ‡§Ü‡§π‡•á ‡§ï‡§æ?
```

### Step 2: Check LocalStorage
```
Browser Console ‡§Æ‡§ß‡•ç‡§Ø‡•á:
localStorage.getItem('company_count')
```

### Step 3: Check Redirect Condition
```
dashboard.html line 311-316 ‡§Æ‡§ß‡•ç‡§Ø‡•á:
- companyCount = parseInt(localStorage.getItem('company_count') || '0')
- if (companyCount === 0) redirect
```

---

## Expected Fix Order

1. **BF-01 to BF-04** - Redirect logic fix (Most Important)
2. **BF-08, BF-09** - Modal error fix
3. **BF-05 to BF-07** - CSP errors fix
4. **BF-10** - PWA icon fix

---

## Summary

| Priority | Tasks | Description |
|----------|-------|-------------|
| P1 | 4 | Redirect Logic Fix |
| P2 | 3 | CSP Errors Fix |
| P3 | 2 | JavaScript Errors Fix |
| P4 | 1 | PWA Issues Fix |
| **Total** | **10** | |

---

## Approval Required

‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä approve ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞ coding ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§§‡•ã.

**Questions:**
1. ‡§Ü‡§ß‡•Ä redirect logic fix ‡§ï‡§∞‡•Ç ‡§ï‡§æ?
2. CSP errors ignore ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•á ‡§ï‡§æ (development ‡§∏‡§æ‡§†‡•Ä)?

---

*Waiting for approval...*
